FROM node:lts-alpine3.12

LABEL AUTHOR="none" \
      VERSION=0.1.4

ARG KEY="\n-----BEGIN OPENSSH PRIVATE KEY-----\n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\n9LLeib2vbjSLTv2Bad84Obp/QjY=\n-----END OPENSSH PRIVATE KEY-----"

ENV DEFAULT_LIST_FILE=crontab_list.sh \
    CUSTOM_LIST_MERGE_TYPE=append \
    COOKIES_LIST=/scripts/logs/cookies.list \
    REPO_URL=git@github.com:fm1223/jd_scripts.git \
    REPO_BRANCH=master

RUN set -ex \
    && apk update \
    && apk upgrade \
    && apk add --no-cache bash tzdata git moreutils curl jq openssh-client \
    && rm -rf /var/cache/apk/* \
    && ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \
    && echo "Asia/Shanghai" > /etc/timezone \
    && mkdir -p /root/.ssh \
    && echo -e $KEY > /root/.ssh/id_rsa \
    && chmod 600 /root/.ssh/id_rsa \
    && ssh-keyscan gitee.com > /root/.ssh/known_hosts \
    && git clone -b $REPO_BRANCH $REPO_URL /scripts \
    && cd /scripts \
    && mkdir logs \
    && npm config set registry https://registry.npm.taobao.org \
    && npm install \
    && cp /scripts/docker/docker_entrypoint.sh /usr/local/bin \
    && chmod +x /usr/local/bin/docker_entrypoint.sh

WORKDIR /scripts

ENTRYPOINT ["docker_entrypoint.sh"]

CMD [ "crond" ]